import pefile

def extract_pe_header(path, output_path, width=16):
    import numpy as np
    from PIL import Image

    pe = pefile.PE(path)
    header_data = pe.get_memory_mapped_image()[:1024]  # First 1KB of PE

    # Pad to make length divisible by width
    pad_len = width - (len(header_data) % width)
    padded = header_data + b'\x00' * pad_len

    # Convert to array and reshape
    array = np.frombuffer(padded, dtype=np.uint8)
    image = array.reshape(-1, width)

    # Convert to image and save
    img = Image.fromarray(image, mode='L')
    img.save(output_path)
    print(f"Saved PE header signature as: {output_path}")

# Example usage
extract_pe_header(r"C:\Users\salag\OneDrive\Desktop\Malware\dist\hello.exe", "header_signature.png")
